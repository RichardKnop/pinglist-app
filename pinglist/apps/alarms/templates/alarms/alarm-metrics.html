{% extends "layout.html" %}
{% load filters %}
{% load humanize %}

{% block content %}

    <!-- Page Content -->
    <div class="container">

        <div class="page-header">
            <h1>Alarm Metrics</h1>
        </div>

        {% for message in messages %}
            <div class="alert alert-{{ message_type_to_alert_class|get:message.tags|escape }}" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                {{ message.message|escape }}
            </div>
        {% endfor %}

        <ul class="list-inline">
            <li><span class="label label-default">
                Uptime {{ uptime|escape }}%
            </span></li>
            <li><span class="label label-default">
                Average {{ average|escape }}ms
            </span></li>
            <li><span class="label label-default">
                Timeouts {{ incident_type_counts.timeout|escape }}
            </span></li>
            <li><span class="label label-default">
                Bad codes {{ incident_type_counts.bad_code|escape }}
            </span></li>
            <li><span class="label label-default">
                Slow responses {{ incident_type_counts.slow_response|escape }}
            </span></li>
            <li><span class="label label-default">
                Other errors {{ incident_type_counts.other|escape }}
            </span></li>
        </ul>

        <div class="panel panel-default">
            <div class="panel-body">
                <canvas id="metricsChart" width="400" height="150"></canvas>
            </div>
            <div class="panel-footer text-center">
                <div class="btn-group" role="group" aria-label="filter">
                    <a class="btn btn-primary{% if active_filter == 'last_hour' %} active{% endif %}"
                       href="{% url 'alarms:alarm_metrics' alarm_id %}?filter=last_hour">
                        1-Hour
                    </a>
                    <a class="btn btn-primary{% if active_filter == 'last_day' %} active{% endif %}"
                       href="{% url 'alarms:alarm_metrics' alarm_id %}?filter=last_day">
                        24-Hour
                    </a>
                    <a class="btn btn-primary{% if active_filter == 'last_week' %} active{% endif %}"
                       href="{% url 'alarms:alarm_metrics' alarm_id %}?filter=last_week">
                        7-Day
                    </a>
                    <a class="btn btn-primary{% if active_filter == 'last_month' %} active{% endif %}"
                       href="{% url 'alarms:alarm_metrics' alarm_id %}?filter=last_month">
                        1-Month
                    </a>
                </div>

            </div>
        </div>

        <hr class="featurette-divider">

    </div>
    <!-- /.container -->

{% endblock %}

{% block inline_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.0/Chart.min.js"></script>
<script>
    {% autoescape off %}
    var ctx = document.getElementById("metricsChart");
    var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [{{ labels }}],
            datasets: [{
                label: 'Response Time (ms)',
                backgroundColor: "rgba(185,232,138,0.4)",
                borderColor: "rgba(39,48,60,1)",
                data: [{{ data|escape }}]
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
    {% endautoescape %}
</script>
{% endblock %}